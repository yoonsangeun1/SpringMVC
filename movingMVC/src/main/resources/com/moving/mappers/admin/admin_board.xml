<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="AdminBoard">

	<resultMap type="normalPostVO" id="postInfo" autoMapping="true">
		<association property="mUserVO" javaType="com.moving.domain.MUserVO" autoMapping="true"
		column="user_id" select="selectBoardAuthor"/>
		<association property="replyPostVO" javaType="com.moving.domain.ReplyPostVO" autoMapping="true"/>
		<association property="profilePostVO" javaType="com.moving.domain.ProfilePostVO" autoMapping="true"/>
	</resultMap>
	
	<!-- 작성자 불러오기 -->
	<select id="selectBoardAuthor" resultType="mUserVO">
		SELECT * FROM M_USER
		WHERE ID = #{user_id}
	</select>
	
	<!-- 게시글 갯수 -->
	<select id="ab_count" resultType="int">
		select sum(cnt) sum_count from
		(
		select  count(id) cnt from normal_post 
		<where>		
			<if test="findField == ''"></if> 
			<if test="findField == 'title+content'">
					title like #{findName} or content like #{findName}
			</if> 
			<if test="findField == 'title'">
					title like #{findName}
			</if> 
			<if test="findField == 'content'">
					content like #{findName}
			</if>
			<if test="findField == 'nickname'">
					user_id like #{userId}
			</if>
			
			<if test="codeNo == '0'"></if>
			<if test="findField == '' and codeNo != 0">
			code_no like #{codeNo}
			</if>
			<if test="findField != '' and codeNo != 0">
			AND code_no like #{codeNo}
			</if>
		</where> 
		
		UNION ALL
		
		select  count(id) cnt from profile_post 
		<where>		
			<if test="findField == ''"></if> 
			<if test="findField == 'title+content'">
					title like #{findName} or content like #{findName}
			</if> 
			<if test="findField == 'title'">
					title like #{findName}
			</if> 
			<if test="findField == 'content'">
					content like #{findName}
			</if> 
			<if test="findField == 'nickname'">
					user_id like #{userId}
			</if>
			
			<if test="codeNo == '0'"></if>
			<if test="findField == '' and codeNo != 0">
			code_no like #{codeNo}
			</if>
			<if test="findField != '' and codeNo != 0">
			AND code_no like #{codeNo}
			</if>
		</where> 
		)
	</select>
	
	<!-- 게시물 목록 -->
	<select id="ab_list" resultMap="postInfo">
	SELECT * FROM
		(
		SELECT ROW_NUMBER() OVER(ORDER BY id DESC) rNum,
		code_no, id, title, user_id, register_date
		FROM 	
			(
			select code_no, id, title, user_id, register_date, move_count from normal_post
				<where>		
				<if test="findField == ''"></if> 
				<if test="findField == 'title+content'">
						title like #{findName} or content like #{findName}
				</if> 
				<if test="findField == 'title'">
						title like #{findName}
				</if> 
				<if test="findField == 'content'">
						content like #{findName}
				</if> 
				<if test="findField == 'nickname'">
					user_id like #{userId}
				</if>
				
			<if test="codeNo == '0'"></if>
			<if test="findField == '' and codeNo != 0">
			code_no like #{codeNo}
			</if>
			<if test="findField != '' and codeNo != 0">
			AND code_no like #{codeNo}
			</if>
		</where> 
			UNION ALL
			select code_no, id, title, user_id, register_date, move_count from profile_post
				<where>		
				<if test="findField == ''"></if> 
				<if test="findField == 'title+content'">
						title like #{findName} or content like #{findName}
				</if> 
				<if test="findField == 'title'">
						title like #{findName}
				</if> 
				<if test="findField == 'content'">
						content like #{findName}
				</if> 
				<if test="findField == 'nickname'">
						user_id like #{userId}
				</if>
				
			<if test="codeNo == '0'"></if>
			<if test="findField == '' and codeNo != 0">
			code_no like #{codeNo}
			</if>
			<if test="findField != '' and codeNo != 0">
			AND code_no like #{codeNo}
			</if>
				</where> 
			order by id desc)
	)
	<where>
		 rNum &gt;= #{startrow} AND rNum &lt;= #{endrow}
	 </where>
	
	</select>
	
	<!-- 닉네임 기준으로 id넘버 찾기 -->
	<select id="findUserIdByNickname" resultType="int">
		SELECT id FROM m_user where nickname = #{findName}
	</select>
	
	<!-- FAQ 작성 -->
	<insert id="faq_in">
		INSERT INTO NORMAL_POST(id, code_no, user_id, question_content, answer_content)
		VAlUES(NORMAL_POST_SEQ.NEXTVAL, 10003, )
	</insert>

	<!-- 공지 작성 -->
	<insert id="notice_in">
		INSERT INTO NORMAL_POST (ID, CODE_NO, USER_ID, TITLE, CONTENT)
		VALUES(NORMAL_POST_SEQ.NEXTVAL, 10001, #{userId}, #{title},
		#{content})
	</insert>
	
	<!-- 공지 내용보기 -->
	<select id="notice_cont" resultMap="postInfo">
		
	</select>
	
	<!-- 공지 수정 -->
	<update id="notice_up">
	
	</update>
	
	<!-- 공지 삭제 -->
	<delete id="notice_del">
	
	</delete>
</mapper>